{% extends "base.html" %}

{% block content %}
<div class="container-fluid py-4">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h2><i class="fas fa-robot me-2"></i>AI Insights & Analytics</h2>
        {% if is_admin %}
        <button class="btn btn-primary" onclick="generateInsights()">
            <i class="fas fa-brain me-1"></i>Generate New Insights
        </button>
        {% endif %}
    </div>

    {% if insights %}
    <div class="row">
        {% for insight in insights %}
        <div class="col-md-6 mb-4">
            <div class="card insight-card border-{{ 'danger' if insight.priority == 'Critical' else 'warning' if insight.priority == 'High' else 'info' }}">
                <div class="card-header d-flex justify-content-between align-items-center">
                    <div>
                        <i class="fas fa-{{ 'exclamation-triangle' if insight.insight_type == 'alert' else 'lightbulb' if insight.insight_type == 'recommendation' else 'chart-line' }} me-2"></i>
                        <strong>{{ insight.title }}</strong>
                    </div>
                    <div>
                        <span class="badge bg-{{ 'danger' if insight.priority == 'Critical' else 'warning' if insight.priority == 'High' else 'info' }}">
                            {{ insight.priority }}
                        </span>
                        <span class="badge bg-secondary ms-1">
                            {{ (insight.confidence_score * 100)|round }}% confidence
                        </span>
                    </div>
                </div>
                <div class="card-body">
                    <p>{{ insight.description }}</p>
                    
                    <!-- Confidence Bar -->
                    <div class="mb-2">
                        <small class="text-muted">AI Confidence Level</small>
                        <div class="progress" style="height: 6px;">
                            <div class="progress-bar bg-{{ 'success' if insight.confidence_score > 0.8 else 'warning' if insight.confidence_score > 0.6 else 'danger' }}" 
                                 style="width: {{ (insight.confidence_score * 100)|round }}%"></div>
                        </div>
                    </div>
                    
                    <small class="text-muted">
                        <i class="fas fa-clock me-1"></i>
                        Generated: {{ insight.generated_date.strftime('%Y-%m-%d %H:%M') }}
                    </small>
                </div>
            </div>
        </div>
        {% endfor %}
    </div>
    {% else %}
    <div class="card">
        <div class="card-body text-center py-5">
            <i class="fas fa-robot fa-3x text-muted mb-3"></i>
            <h5>No AI Insights Available</h5>
            <p class="text-muted">{% if is_admin %}Generate insights to get AI-powered recommendations{% else %}AI insights will appear here when generated by an admin{% endif %}</p>
            {% if is_admin %}
            <button class="btn btn-primary" onclick="generateInsights()">Generate Insights</button>
            {% endif %}
        </div>
    </div>
    {% endif %}
</div>

<style>
.insight-card {
    transition: transform 0.2s ease;
}

.insight-card:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(0,0,0,0.15);
}

/* Mobile Responsive Styles */
@media (max-width: 768px) {
    .insight-card .card-header {
        flex-direction: column;
        align-items: flex-start;
    }
    
    .insight-card .badge {
        margin-top: 5px;
        margin-left: 0 !important;
    }
    
    .insight-card {
        margin-bottom: 15px;
    }
    
    .progress {
        height: 8px;
    }
}
</style>

<script>
function generateInsights() {
    // Reload page to generate new insights
    window.location.reload();
}
</script>
{% endblock %}