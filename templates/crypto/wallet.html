{% extends "base.html" %}

{% block content %}
<div class="container-fluid py-4">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h2><i class="fas fa-wallet me-2"></i>Crypto Wallet</h2>
        <div>
            <button class="btn btn-primary" onclick="refreshBalances()">
                <i class="fas fa-sync me-1"></i>Refresh
            </button>
        </div>
    </div>

    <!-- Wallet Overview -->
    <div class="row mb-4">
        <div class="col-md-4">
            <div class="card bg-warning text-dark">
                <div class="card-body stats-card text-center">
                    <h4>{{ "%.6f"|format(wallet.balance_btc) }}</h4>
                    <small>Bitcoin (BTC)</small>
                </div>
            </div>
        </div>
        <div class="col-md-4">
            <div class="card bg-info text-white">
                <div class="card-body stats-card text-center">
                    <h4>{{ "%.6f"|format(wallet.balance_eth) }}</h4>
                    <small>Ethereum (ETH)</small>
                </div>
            </div>
        </div>
        <div class="col-md-4">
            <div class="card bg-success text-white">
                <div class="card-body stats-card text-center">
                    <h4>{{ "%.2f"|format(wallet.balance_usdt) }}</h4>
                    <small>Tether (USDT)</small>
                </div>
            </div>
        </div>
    </div>

    <div class="row">
        <!-- Wallet Details -->
        <div class="col-md-8">
            <div class="card">
                <div class="card-header">
                    <h5>Wallet Information</h5>
                </div>
                <div class="card-body">
                    <div class="mb-3">
                        <label class="form-label">Wallet Address</label>
                        <div class="input-group">
                            <input type="text" class="form-control font-monospace" 
                                   value="{{ wallet.wallet_address }}" readonly>
                            <button class="btn btn-outline-secondary" onclick="copyToClipboard('{{ wallet.wallet_address }}')">
                                <i class="fas fa-copy"></i>
                            </button>
                        </div>
                    </div>
                    
                    <div class="mb-3">
                        <label class="form-label">Created Date</label>
                        <input type="text" class="form-control" 
                               value="{{ wallet.created_date.strftime('%Y-%m-%d %H:%M') }}" readonly>
                    </div>
                    
                    <div class="mb-3">
                        <label class="form-label">Status</label>
                        <span class="badge bg-{{ 'success' if wallet.is_active else 'danger' }} ms-2">
                            {{ 'Active' if wallet.is_active else 'Inactive' }}
                        </span>
                    </div>

                    <!-- QR Code -->
                    <div class="text-center mt-4">
                        <div id="qrcode"></div>
                        <small class="text-muted">Scan QR code to share wallet address</small>
                    </div>
                </div>
            </div>
        </div>

        <!-- Quick Actions -->
        <div class="col-md-4">
            <div class="card">
                <div class="card-header">
                    <h5>Quick Actions</h5>
                </div>
                <div class="card-body">
                    <div class="d-grid gap-2">
                        <button class="btn btn-success" onclick="showSendModal()">
                            <i class="fas fa-paper-plane me-2"></i>Send Crypto
                        </button>
                        <button class="btn btn-primary" onclick="showReceiveModal()">
                            <i class="fas fa-download me-2"></i>Receive Crypto
                        </button>
                        <button class="btn btn-info" onclick="showSwapModal()">
                            <i class="fas fa-exchange-alt me-2"></i>Swap Tokens
                        </button>
                        <button class="btn btn-warning" onclick="showStakeModal()">
                            <i class="fas fa-coins me-2"></i>Stake Tokens
                        </button>
                    </div>
                </div>
            </div>

            <!-- Price Tracker -->
            <div class="card mt-3">
                <div class="card-header">
                    <h5>Live Prices</h5>
                </div>
                <div class="card-body">
                    <div class="d-flex justify-content-between mb-2">
                        <span>BTC/USD</span>
                        <span class="text-success" id="btc-price">Loading...</span>
                    </div>
                    <div class="d-flex justify-content-between mb-2">
                        <span>ETH/USD</span>
                        <span class="text-success" id="eth-price">Loading...</span>
                    </div>
                    <div class="d-flex justify-content-between">
                        <span>USDT/USD</span>
                        <span class="text-success" id="usdt-price">$1.00</span>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
.font-monospace {
    font-family: 'Courier New', monospace;
}

#qrcode {
    margin: 20px 0;
}
</style>

<script src="https://cdn.jsdelivr.net/npm/qrcode@1.5.3/build/qrcode.min.js"></script>
<script>
// Generate QR Code
QRCode.toCanvas(document.getElementById('qrcode'), '{{ wallet.wallet_address }}', {
    width: 200,
    margin: 2,
    color: {
        dark: '#000000',
        light: '#FFFFFF'
    }
});

function copyToClipboard(text) {
    navigator.clipboard.writeText(text).then(() => {
        alert('Wallet address copied to clipboard!');
    });
}

function refreshBalances() {
    // Simulate balance refresh
    alert('Balances refreshed! (Demo mode - connect to real crypto APIs)');
}

function showSendModal() {
    alert('Send crypto feature coming soon! This would integrate with blockchain networks.');
}

function showReceiveModal() {
    alert('Your wallet address: {{ wallet.wallet_address }}');
}

function showSwapModal() {
    alert('Token swap feature coming soon! This would integrate with DEX protocols.');
}

function showStakeModal() {
    alert('Staking feature coming soon! This would integrate with DeFi protocols.');
}

// Simulate live price updates
function updatePrices() {
    // In production, connect to real crypto price APIs
    document.getElementById('btc-price').textContent = '$' + (45000 + Math.random() * 1000).toFixed(2);
    document.getElementById('eth-price').textContent = '$' + (3000 + Math.random() * 100).toFixed(2);
}

// Update prices every 30 seconds
setInterval(updatePrices, 30000);
updatePrices(); // Initial load
</script>
{% endblock %}